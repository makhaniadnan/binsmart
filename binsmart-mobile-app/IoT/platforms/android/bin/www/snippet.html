<!DOCTYPE html>
<html>
<meta charset="UTF-8">

<head>
    <script type="text/javascript" src="js/mqttws31.js"></script>

    <script type="text/javascript" src="js/Long.min.js"></script>
    <script type="text/javascript" src="js/ByteBufferAB.min.js"></script>
    <script type="text/javascript" src="js/ProtoBuf.min.js"></script>
    <script type="text/javascript" src="js/fs.js"></script>
    <script type="text/javascript" src="js/bundle.js"></script>

</head>
<body>

<h2>A demo for showing the pub/sub between clients and the message broker</p> <h3>IoTGateway</h3>
    Topic :
    <input type="text" name="pub"/>
    Message:
    <input type="text" name="pub"/>
    <button onclick="connect()">
        Connect
    </button>
    <br>
    <button onclick="publish()">
        Publish
    </button>
    <br>

    <h3>BluetoothID</h3> Topic:
    <input type="text" name="sub"/>
    <button onclick="subscribe()">
        Subscribe
    </button>
    <br>

    <p id="sub"></p>
    <script>
			/*if ( typeof dcodeIO === 'undefined' || !dcodeIO.ProtoBuf) {
				throw (new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions."));
			}
			var ProtoBuf = dcodeIO.ProtoBuf;
			var builder = ProtoBuf.loadProtoFile("./example.proto"),
			    MqttMessage = builder.build("KuraPayload.KuraMetric");
			    console.log("builder has built");
			    //Car = Game1.Car;
			var mqtt = new MqttMessage({
				"name" : "testing",
				
			});
			var buffer = mqtt.encode();
			console.log("this is the encded message");
			console.log(buffer);
			var messagegpb = buffer.toBuffer();
			console.log("this message is converted to buffer");
			console.log(messagegpb);
			
			console.log("the decoded message");

			var msg = MqttMessage.decode(messagegpb);
			console.log(msg);*/
			function connect() {
				clientPublish = new Paho.MQTT.Client("m11.cloudmqtt.com", 37193, "myClientIdPub1");
				clientPublish.connect({
					useSSL : true,
					userName : "rvigfsyx",
					password : "ifCTVLo5YlP9",
					onSuccess : onConnect
				});
				function onConnect() {
					console.log("connection successful");
				}

			}

			function publish() {

			window.mqtt = new navigator.mqtt_plugin();
			window.mqtt.publish({
   		     data: "plugin is working",
   		     topic: "plugin"
  		  }


			} );

			function subscribe() {
			window.mqtt = new navigator.mqtt_plugin();
			window.mqtt.subscribe({
   		     topic: "plugin"
  		  },
 			  function(data){
       		 // success callback
     		   console.log(data);
   			 }

			);

				

			}


    </script>
</body>
</html>